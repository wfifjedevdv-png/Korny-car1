<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Mouhamed Motors</title>

<style>
body{
  margin:0;
  background:#000;
  color:white;
  font-family:Segoe UI,Tahoma;
}
#login{
 display:flex;
 justify-content:center;
 align-items:center;
 height:100vh;
}
.login-box{
 background:rgba(255,255,255,.08);
 padding:32px;
 width:340px;
 border-radius:24px;
 text-align:center;
}
input{
 width:100%;
 padding:13px 14px;
 margin-top:14px;
 border-radius:14px;
 border:1px solid rgba(255,255,255,.08);
 background:#020617;
 color:white;
 font-size:15px;
}
button{
 width:100%;
 padding:13px;
 margin-top:18px;
 border:none;
 border-radius:14px;
 background:linear-gradient(135deg,#1e90ff,#3aa0ff);
 color:white;
 font-size:16px;
 cursor:pointer;
}
.link{
 margin-top:14px;
 color:#3aa0ff;
 cursor:pointer;
 font-size:14px;
}
#error{
 color:#ff6b6b;
 margin-top:12px;
 display:none;
}
nav{
 display:none;
 justify-content:space-between;
 align-items:center;
 padding:15px 20px;
 background:#020617;
}
#content{
 display:none;
 padding:20px;
 max-width:1200px;
 margin:auto;
}
.search{
 margin-bottom:20px;
 width:100%;
 padding:12px;
 border-radius:14px;
 border:none;
 background:#111827;
 color:white;
}
.cars{
 display:grid;
 grid-template-columns:repeat(auto-fit,minmax(250px,1fr));
 gap:20px;
}
.car{
 background:rgba(255,255,255,.08);
 border-radius:20px;
 overflow:hidden;
 transition:.3s;
}
.car img{
 width:100%;
 height:180px;
 object-fit:cover;
}
.car .info{ padding:15px; }
.price{ color:#3aa0ff; font-weight:bold; }
</style>
</head>

<body>

<!-- LOGIN -->
<div id="login">
 <div class="login-box">
  <h2 id="formTitle">ğŸ” ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„</h2>

  <input id="name" placeholder="Ø§Ø³Ù…Ùƒ" style="display:none">
  <input id="email" placeholder="Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ">
  <input id="password" type="password" placeholder="ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±">

  <button onclick="submitForm()">Ø¯Ø®ÙˆÙ„</button>
  <div class="link" onclick="toggleForm()">Ø¥Ù†Ø´Ø§Ø¡ Ø­Ø³Ø§Ø¨ Ø¬Ø¯ÙŠØ¯</div>
  <div id="error"></div>
 </div>
</div>

<!-- NAV -->
<nav id="nav">
 <h3>ğŸš— Mouhamed Motors</h3>
 <button onclick="logout()" style="width:auto;padding:8px 16px">Ø®Ø±ÙˆØ¬</button>
</nav>

<!-- CONTENT -->
<div id="content">
 <input class="search" id="search" placeholder="ğŸ” Ø§Ø¨Ø­Ø« Ø¹Ù† Ø³ÙŠØ§Ø±Ø©" oninput="renderCars()">
 <div class="cars" id="cars"></div>
</div>

<!-- SUPABASE -->
<script type="module">
import { createClient } from "https://cdn.jsdelivr.net/npm/@supabase/supabase-js/+esm";

/* ğŸ”‘ Ø¶Ø¹ Ø¨ÙŠØ§Ù†Ø§Øª Supabase Ù‡Ù†Ø§ */
const SUPABASE_URL"https://fquwikhishikbysnzqfd.supabase.co";
const SUPABASE_ANON_KEY = "sb_publishable_5MYNJ7ek_LaarRhPDBNODg_Yz-4qthG";

const supabase = createClient(SUPABASE_URL, SUPABASE_ANON_KEY);

/* Ø¹Ù†Ø§ØµØ± */
const loginBox = document.getElementById("login");
const nav = document.getElementById("nav");
const content = document.getElementById("content");
const error = document.getElementById("error");

const nameInput = document.getElementById("name");
const emailInput = document.getElementById("email");
const passInput = document.getElementById("password");
const formTitle = document.getElementById("formTitle");

let isRegister = false;

/* ØªØ¨Ø¯ÙŠÙ„ */
window.toggleForm = function(){
 isRegister = !isRegister;
 formTitle.innerText = isRegister ? "ğŸ†• Ø¥Ù†Ø´Ø§Ø¡ Ø­Ø³Ø§Ø¨" : "ğŸ” ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„";
 nameInput.style.display = isRegister ? "block" : "none";
 error.style.display = "none";
}

/* Ø¯Ø®ÙˆÙ„ / ØªØ³Ø¬ÙŠÙ„ */
window.submitForm = async function(){
 const email = emailInput.value.trim();
 const pass = passInput.value.trim();
 const name = nameInput.value.trim();

 if(!email || !pass || (isRegister && !name)){
  showError("Ø£ÙƒÙ…Ù„ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ù‚ÙˆÙ„");
  return;
 }

 if(isRegister){
  await supabase.from("users").insert({
   name,
   email,
   password: pass,
   role: "user"
  });
 }

 const { data:user } = await supabase
  .from("users")
  .select("*")
  .eq("email", email)
  .eq("password", pass)
  .single();

 if(!user){
  showError("Ø¨ÙŠØ§Ù†Ø§Øª ØºÙŠØ± ØµØ­ÙŠØ­Ø©");
  return;
 }

 localStorage.setItem("session", JSON.stringify(user));
 start();
}

/* Ø¨Ø¯Ø¡ */
function start(){
 const session = JSON.parse(localStorage.getItem("session"));
 if(!session) return;

 loginBox.style.display="none";
 nav.style.display="flex";
 content.style.display="block";
 renderCars();
}

/* Ø®Ø±ÙˆØ¬ */
window.logout = function(){
 localStorage.removeItem("session");
 location.reload();
}

/* Ø¹Ø±Ø¶ Ø§Ù„Ø³ÙŠØ§Ø±Ø§Øª */
window.renderCars = async function(){
 const q = document.getElementById("search").value.toLowerCase();
 const box = document.getElementById("cars");
 box.innerHTML="";

 const { data:cars } = await supabase.from("cars").select("*");

 if(!cars || cars.length === 0){
  box.innerHTML="<p style='opacity:.6'>ğŸš— Ù„Ø§ ØªÙˆØ¬Ø¯ Ø³ÙŠØ§Ø±Ø§Øª</p>";
  return;
 }

 cars
  .filter(c => c.name.toLowerCase().includes(q))
  .forEach(c => {
   box.innerHTML += `
    <div class="car">
     <img src="${c.img}">
     <div class="info">
      <h4>${c.name}</h4>
      <p>${c.desc || ""}</p>
      <div class="price">${c.price}</div>
     </div>
    </div>
   `;
  });
}

function showError(msg){
 error.innerText = msg;
 error.style.display = "block";
}

start();
</script>

</body>
  </html>
